{% extends "base.html" %}
{% block title %}Edit User – {{ target_user.username }}{% endblock %}

{% block content %}
<div class="container" style="max-width:620px;">

  <div class="d-flex align-items-center gap-3 mb-4">
    <a href="{% url 'manage_users' %}" class="btn btn-outline-secondary btn-sm">← Back</a>
    <div>
      <h2 class="page-title mb-0">✏️ Edit User: {{ target_user.username }}</h2>
      <p class="page-subtitle mb-0">Update role, module access, and account status.</p>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
  {% endif %}

  <div class="card p-4" style="border-radius:14px;">
    <!-- User info banner -->
    <div class="d-flex align-items-center gap-3 mb-4 pb-3" style="border-bottom:1px solid #e2e8f0;">
      <div style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#6366f1,#0ea5e9);
                  display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:1rem;">
        {{ target_user.username|slice:":2"|upper }}
      </div>
      <div>
        <p class="mb-0 fw-semibold">{{ target_user.username }}</p>
        <p class="mb-0 text-muted" style="font-size:0.8rem;">{{ target_user.email|default:"No email" }}</p>
      </div>
    </div>

    <form method="post">
      {% csrf_token %}

      <div class="mb-3">
        <label class="form-label fw-semibold">Role</label>
        <select name="role" class="form-select">
          {% if admin_profile.role == 'tenant_admin' %}
          <option value="tenant_admin" {% if target_profile.role == 'tenant_admin' %}selected{% endif %}>Tenant Admin</option>
          <option value="manager"      {% if target_profile.role == 'manager'      %}selected{% endif %}>Manager</option>
          {% endif %}
          <option value="cashier" {% if target_profile.role == 'cashier' %}selected{% endif %}>Cashier</option>
          <option value="staff"   {% if target_profile.role == 'staff'   %}selected{% endif %}>Staff</option>
        </select>
      </div>

      <div class="mb-4">
        <label class="form-label fw-semibold d-block mb-2">Module Access</label>
        <div class="d-flex flex-wrap gap-3">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="can_access_inventory" id="e_inv"
                   {% if target_profile.can_access_inventory %}checked{% endif %}>
            <label class="form-check-label" for="e_inv">Inventory</label>
          </div>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="can_access_sales" id="e_sal"
                   {% if target_profile.can_access_sales %}checked{% endif %}>
            <label class="form-check-label" for="e_sal">Sales / POS</label>
          </div>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="can_access_customers" id="e_cust"
                   {% if target_profile.can_access_customers %}checked{% endif %}>
            <label class="form-check-label" for="e_cust">Customers</label>
          </div>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="can_access_reports" id="e_rep"
                   {% if target_profile.can_access_reports %}checked{% endif %}>
            <label class="form-check-label" for="e_rep">Reports</label>
          </div>
        </div>
      </div>

      <div class="mb-4">
        <label class="form-label fw-semibold d-block mb-2">Account Status</label>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" name="is_active" id="e_active"
                 {% if target_profile.is_active %}checked{% endif %}>
          <label class="form-check-label" for="e_active">Active (user can log in)</label>
        </div>
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Save Changes</button>
        <a href="{% url 'manage_users' %}" class="btn btn-outline-secondary">Cancel</a>
      </div>
    </form>
  </div>

</div>
{% endblock %}
