{% extends "base.html" %}
{% block title %}Manage Users{% endblock %}

{% block content %}
<div class="container-fluid">

  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
    <div>
      <h2 class="page-title mb-1">ðŸ‘¥ Manage Users</h2>
      <p class="page-subtitle mb-0">Create and control staff access for your shop.</p>
    </div>
    <a href="{% url 'create_user' %}" class="btn btn-primary btn-sm">+ Add User</a>
  </div>

  {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
  {% endif %}

  <div class="card" style="border-radius:14px;overflow:hidden;">
    <table class="table mb-0" style="font-size:0.88rem;">
      <thead style="background:#f1f5f9;">
        <tr>
          <th class="ps-4">Username</th>
          <th>Role</th>
          <th>Status</th>
          <th>Inventory</th>
          <th>Sales</th>
          <th>Customers</th>
          <th>Reports</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for up in staff_users %}
        <tr>
          <td class="ps-4 fw-semibold">
            {{ up.user.username }}
            {% if up.user == request.user %}<span class="badge bg-secondary ms-1" style="font-size:.7rem;">You</span>{% endif %}
          </td>
          <td>
            <span class="badge"
              style="background:{% if up.role == 'tenant_admin' %}#6366f1{% elif up.role == 'manager' %}#0ea5e9{% elif up.role == 'cashier' %}#10b981{% else %}#64748b{% endif %};color:#fff;font-size:0.75rem;">
              {{ up.get_role_display }}
            </span>
          </td>
          <td>
            {% if up.is_active %}
              <span class="badge" style="background:#dcfce7;color:#15803d;font-size:.75rem;">Active</span>
            {% else %}
              <span class="badge" style="background:#fee2e2;color:#b91c1c;font-size:.75rem;">Inactive</span>
            {% endif %}
          </td>
          <td>{% if up.can_access_inventory %}âœ…{% else %}â€”{% endif %}</td>
          <td>{% if up.can_access_sales %}âœ…{% else %}â€”{% endif %}</td>
          <td>{% if up.can_access_customers %}âœ…{% else %}â€”{% endif %}</td>
          <td>{% if up.can_access_reports %}âœ…{% else %}â€”{% endif %}</td>
          <td class="text-end pe-3">
            {% if up.user != request.user and up.role != 'superadmin' %}
              {% if admin_profile.role == 'tenant_admin' or up.role not in 'tenant_admin,manager' %}
              <a href="{% url 'edit_user' up.user.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
              {% endif %}
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center text-muted py-4">No staff users yet. <a href="{% url 'create_user' %}">Add one.</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
