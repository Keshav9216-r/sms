{% extends 'base.html' %}
{% block title %}Change Password{% endblock %}

{% block content %}
<div class="container" style="max-width: 480px;">

  <!-- Page header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="page-title mb-1">Change Password</h2>
      <p class="page-subtitle mb-0">Update your account password</p>
    </div>
    <a href="{% url 'profile' %}" class="btn btn-outline-primary btn-sm">
      &#8592; Back to Profile
    </a>
  </div>

  <div class="card p-4">
    <!-- Icon banner -->
    <div class="text-center mb-4">
      <div style="width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,#6366f1,#0ea5e9);display:inline-flex;align-items:center;justify-content:center;">
        <span style="font-size:1.5rem;">&#128274;</span>
      </div>
    </div>

    <form method="post" novalidate>
      {% csrf_token %}

      <div class="mb-3">
        <label for="current_password" class="form-label fw-semibold">Current Password</label>
        <input
          type="password"
          id="current_password"
          name="current_password"
          class="form-control"
          placeholder="Enter your current password"
          required
          autocomplete="current-password"
        >
      </div>

      <div class="mb-3">
        <label for="new_password" class="form-label fw-semibold">New Password</label>
        <input
          type="password"
          id="new_password"
          name="new_password"
          class="form-control"
          placeholder="Enter a strong new password"
          required
          autocomplete="new-password"
          oninput="checkStrength(this.value)"
        >
        <!-- Password strength indicator -->
        <div id="strength-bar" class="mt-2" style="height:4px;border-radius:2px;background:#e2e8f0;overflow:hidden;">
          <div id="strength-fill" style="height:100%;width:0;transition:width 0.3s,background 0.3s;border-radius:2px;"></div>
        </div>
        <small id="strength-label" class="text-muted" style="font-size:0.78rem;"></small>
      </div>

      <div class="mb-4">
        <label for="new_password2" class="form-label fw-semibold">Confirm New Password</label>
        <input
          type="password"
          id="new_password2"
          name="new_password2"
          class="form-control"
          placeholder="Repeat the new password"
          required
          autocomplete="new-password"
        >
      </div>

      <div class="d-grid gap-2">
        <button type="submit" class="btn btn-primary">Update Password</button>
        <a href="{% url 'profile' %}" class="btn btn-outline-secondary">Cancel</a>
      </div>
    </form>
  </div>

  <!-- Password rules hint -->
  <div class="card p-3 mt-3" style="background:#f8fafc;">
    <p class="mb-1 fw-semibold" style="font-size:0.83rem;color:#475569;">Password requirements:</p>
    <ul class="mb-0" style="font-size:0.82rem;color:#64748b;padding-left:1.2em;">
      <li>At least 8 characters long</li>
      <li>Cannot be too similar to your username</li>
      <li>Cannot be a commonly used password</li>
      <li>Cannot be entirely numeric</li>
    </ul>
  </div>

</div>

<script>
function checkStrength(pw) {
  var fill = document.getElementById('strength-fill');
  var label = document.getElementById('strength-label');
  var score = 0;
  if (pw.length >= 8)  score++;
  if (pw.length >= 12) score++;
  if (/[A-Z]/.test(pw)) score++;
  if (/[0-9]/.test(pw)) score++;
  if (/[^A-Za-z0-9]/.test(pw)) score++;

  var colors = ['#ef4444','#f97316','#eab308','#22c55e','#10b981'];
  var labels = ['Very weak','Weak','Fair','Strong','Very strong'];
  var widths = ['20%','40%','60%','80%','100%'];

  var idx = Math.max(0, Math.min(score - 1, 4));
  fill.style.width = pw.length === 0 ? '0' : widths[idx];
  fill.style.background = colors[idx];
  label.textContent = pw.length === 0 ? '' : labels[idx];
}
</script>
{% endblock %}
