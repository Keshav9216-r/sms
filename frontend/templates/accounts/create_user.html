{% extends "base.html" %}
{% block title %}Create User{% endblock %}

{% block content %}
<div class="container" style="max-width:620px;">

  <div class="d-flex align-items-center gap-3 mb-4">
    <a href="{% url 'manage_users' %}" class="btn btn-outline-secondary btn-sm">← Back</a>
    <div>
      <h2 class="page-title mb-0">➕ Create Staff User</h2>
      <p class="page-subtitle mb-0">Add a new staff member to your shop.</p>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
  {% endif %}

  <div class="card p-4" style="border-radius:14px;">
    <form method="post">
      {% csrf_token %}

      <div class="row g-3 mb-3">
        <div class="col-sm-6">
          <label class="form-label fw-semibold">Username <span class="text-danger">*</span></label>
          <input type="text" name="username" class="form-control"
                 value="{{ form_data.username|default:'' }}" required autocomplete="off">
        </div>
        <div class="col-sm-6">
          <label class="form-label fw-semibold">Email</label>
          <input type="email" name="email" class="form-control"
                 value="{{ form_data.email|default:'' }}" placeholder="optional">
        </div>
      </div>

      <div class="row g-3 mb-3">
        <div class="col-sm-6">
          <label class="form-label fw-semibold">Password <span class="text-danger">*</span></label>
          <input type="password" name="password" class="form-control" required>
        </div>
        <div class="col-sm-6">
          <label class="form-label fw-semibold">Confirm Password <span class="text-danger">*</span></label>
          <input type="password" name="password2" class="form-control" required>
        </div>
      </div>

      <div class="mb-4">
        <label class="form-label fw-semibold">Role <span class="text-danger">*</span></label>
        <select name="role" class="form-select">
          {% if admin_profile.role == 'tenant_admin' %}
          <option value="tenant_admin" {% if form_data.role == 'tenant_admin' %}selected{% endif %}>Tenant Admin</option>
          <option value="manager" {% if form_data.role == 'manager' %}selected{% endif %}>Manager</option>
          {% endif %}
          <option value="cashier" {% if form_data.role == 'cashier' or not form_data.role %}selected{% endif %}>Cashier</option>
          <option value="staff" {% if form_data.role == 'staff' %}selected{% endif %}>Staff</option>
        </select>
      </div>

      <div class="mb-4">
        <label class="form-label fw-semibold d-block mb-2">Module Access</label>
        <div class="d-flex flex-wrap gap-3">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="can_access_inventory" id="acc_inv"
                   {% if form_data.can_access_inventory != 'off' %}checked{% endif %}>
            <label class="form-check-label" for="acc_inv">Inventory</label>
          </div>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="can_access_sales" id="acc_sal"
                   {% if form_data.can_access_sales != 'off' %}checked{% endif %}>
            <label class="form-check-label" for="acc_sal">Sales / POS</label>
          </div>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="can_access_customers" id="acc_cust"
                   {% if form_data.can_access_customers != 'off' %}checked{% endif %}>
            <label class="form-check-label" for="acc_cust">Customers</label>
          </div>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="can_access_reports" id="acc_rep"
                   {% if form_data.can_access_reports != 'off' %}checked{% endif %}>
            <label class="form-check-label" for="acc_rep">Reports</label>
          </div>
        </div>
        <small class="text-muted">All modules are enabled by default. Un-check to restrict access.</small>
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Create User</button>
        <a href="{% url 'manage_users' %}" class="btn btn-outline-secondary">Cancel</a>
      </div>
    </form>
  </div>

</div>
{% endblock %}
